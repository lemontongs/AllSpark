<!DOCTYPE html>
<html lang="en">
  <!--
  
    Current string args:
        1: List of floor names          (string)
        2: Temperature data filename    (string)
        3: Memory javascript            (string)
        4: Table of user data           (string)
        5: Table of security data       (string)
        6: Table of furnace data        (string)
        7: Average temperature          (float)
        8: Top current temperature      (float)
        9: Top current set point        (float)
       10: Main current temperature     (float)
       11: Main current set point       (float)
       12: Basement current temperature (float)
       13: Basement current set point   (float)
       14: User HTML                    (string)
       15: Front door state             (string)
       16: Memory HTML                  (string)
    
    -->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Lemontongs">
    <link rel="icon" href="favicon.ico">

    <title>Home Control</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <script src="jquery.bootstrap-touchspin.min.js"></script>
    
    <!-- Bootstrap core CSS -->
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="jquery.bootstrap-touchspin.min.css" rel="stylesheet"/>

    <!-- Custom styles for this template
    <link href="navbar.css" rel="stylesheet"> -->
    
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script type="text/javascript">
            
            google.load("visualization", "1", {packages:["corechart","timeline"]});
            
            var ready_function_array = []
            
            
            
            
            
            function updateSetPoint(device)
            {
                var set_point = $("input[name='"+device+"']").val()
                
                $.get("cgi-bin/set_temp.py?set_temp="+set_point+"&floor="+device, function (result)
                { 
                    if (result.trim() == "OK")
                    {
                        $("button[name='"+device+"_btn']").toggleClass('btn-primary');
                        $("button[name='"+device+"_btn']").toggleClass('btn-success');
                        setTimeout(function()
                        {
                            $("button[name='"+device+"_btn']").toggleClass('btn-success');
                            $("button[name='"+device+"_btn']").toggleClass('btn-primary');
                        }, 5000);
                    }
                    else
                    {
                        $("button[name='"+device+"_btn']").toggleClass('btn-primary');
                        $("button[name='"+device+"_btn']").toggleClass('btn-danger');
                        alert(result);
                        setTimeout(function()
                        {
                            $("button[name='"+device+"_btn']").toggleClass('btn-danger');
                            $("button[name='"+device+"_btn']").toggleClass('btn-primary');
                        }, 5000);
                    }
                });
            }
            
            
            
            
            
            function drawTempData(data)
            {
                var rows = data.split("\n");
                
                var result = [['Time' %s ]]; // , 'first', 'second', 'basement'                     //   FLOOR NAMES
                
                for ( var i = 0; i < rows.length; i++)
                {
                    var row = rows[i];
                    var items = row.split(",");
                    if (items.length != 4)
                        continue;
                    
                    var time = items[0];
                    
                    var d = new Date(0); // The 0 there is the key, which sets the date to the epoch
                    d.setUTCSeconds(parseInt(time));
                    
                    var now = new Date();
                    var days = (now - d)/(1000*60*60*24);
                    if (days > 0.5)
                    {
                        continue;
                    }
                    
                    var temps = [];
                    temps.push(d);
                    for (var t = 1; t < items.length; t++ )
                    {
                        temps[t] = parseFloat(items[t]);
                        if (temps[t] == NaN)
                        {
                            temps[t] = null;
                        }
                    }
                    
                    result.push(temps);
                }
                
                var data = google.visualization.arrayToDataTable(result);
                var options = { title: 'Zone Temperatures (F)' };//,
                             //   hAxis: { showTextEvery: Math.floor(data.getNumberOfRows() / 5) } };

                var chart = new google.visualization.LineChart(document.getElementById('temp_chart_div'));
                chart.draw(data, options);
            }
            
            function drawTempDataOnReady()
            {
                $.get("%s", function (data) { drawTempData(data);  })                             //   TEMPERATURE DATA FILENAME
            }
            ready_function_array.push( drawTempDataOnReady )
            
            
            
            
            
            %s                                                                                      // MEMORY JAVASCRIPT
            
            
            %s                                                                                      // USER JAVASCRIPT
            
            
            %s                                                                                      // SECURITY JAVASCRIPT
            
            
            %s                                                                                      // FURNACE JAVASCRIPT
            
            
            $(document).ready(function ()
            {   
                for ( var i = 0; i < ready_function_array.length; i++)
                {
                	ready_function_array[i]()
                }
            });
            
        </script>

  </head>

  <body>

    <div class="container">
    
      <!-- Static navbar -->
      <nav class="navbar navbar-default">
        <div class="container-fluid">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">Home Control</a>
          </div>
          <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
              <li><a href="#thermostats">Thermostats</a></li>
              <li><a href="#plot"       >Plot</a></li>
              <li><a href="#whosehome"  >Who is home?</a></li>
              <li><a href="#security"   >Security</a></li>
              <li><a href="#sysinfo"    >System Info</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div><!--/.container-fluid -->
      </nav><!-- /.navbar -->
      
      
      
      %s                                                                                  <!-- THERMOSTAT HTML -->
      
      %s                                                                                  <!-- FURNACE HTML -->
      
      
      
      <div id="thermostats" class="jumbotron">
        <!-- Temp control -->
        <div class="row">
          <div class="col-md-2">
            <h2>2nd Floor</h2>
            <p>Current: %.1f</p>                                                            <!-- TOP CURRENT TEMP -->
          </div>
          <div class="col-md-5">
            <h2></h2>
            <div class="input-group input-group-lg">
              <input id="demo5" type="text" class="form-control" name="top_floor_temp" value="%.1f">   <!-- TOP SET POINT -->
              <div class="input-group-btn">
                  <button name="top_floor_temp_btn" type="button" class="btn btn-primary" onclick="updateSetPoint('top_floor_temp')">Submit</button>
              </div>
            </div>
            <script>
              $("input[name='top_floor_temp']").TouchSpin({
                  min: 50,
                  max: 80,
                  step: 0.5,
                  decimals: 1,
                  boostat: 5,
                  maxboostedstep: 10,
                  prefix: "Set:",
                  postfix: 'F'
                  });
            </script>
          </div>
        </div>
  
  
        <!-- Temp control -->
        <div class="row">
          <div class="col-md-2">
            <h2>1st Floor</h2>
            <p>Current: %.1f</p>                                                            <!-- MAIN CURRENT TEMP -->
          </div>
          <div class="col-md-5">
            <h2></h2>
            <div class="input-group input-group-lg">
              <input id="demo5" type="text" class="form-control" name="main_floor_temp" value="%.1f">   <!-- MAIN SET POINT -->
              <div class="input-group-btn">
                  <button name="main_floor_temp_btn" type="button" class="btn btn-primary" onclick="updateSetPoint('main_floor_temp')">Submit</button>
              </div>
            </div>
            <script>
              $("input[name='main_floor_temp']").TouchSpin({
                  min: 50,
                  max: 80,
                  step: 0.5,
                  decimals: 1,
                  boostat: 5,
                  maxboostedstep: 10,
                  prefix: "Set:",
                  postfix: 'F'
                  });
            </script>
          </div>
        </div>
  
  
        <!-- Temp control -->
        <div class="row">
          <div class="col-md-2">
            <h2>Basement</h2>
            <p>Current: %.1f</p>                                                            <!-- BASEMENT CURRENT TEMP -->
          </div>
          <div class="col-md-5">
            <h2></h2>
            <div class="input-group input-group-lg">
              <input id="demo5" type="text" class="form-control" name="basement_floor_temp" value="%.1f">   <!-- BASEMENT SET POINT -->
              <div class="input-group-btn">
                  <button name="basement_floor_temp_btn" type="button" class="btn btn-primary" onclick="updateSetPoint('basement_floor_temp')">Submit</button>
              </div>
            </div>
            <script>
              $("input[name='basement_floor_temp']").TouchSpin({
                  min: 50,
                  max: 80,
                  step: 0.5,
                  decimals: 1,
                  boostat: 5,
                  maxboostedstep: 10,
                  prefix: "Set:",
                  postfix: 'F'
                  });
            </script>
          </div>
        </div>
      </div>
      
      
      %s                                                                                  <!-- USER HTML -->
      
      %s                                                                                  <!-- SECURITY HTML -->
      
      %s                                                                                  <!-- MEMORY HTML -->
      
      <!-- Footer -->
      <div class="row">
        <div class="col-md-12">
          <div class="footer">
            <p>&copy; Lemontongs 2015</p>
          </div>
        </div>
      </div>
    
    </div> <!-- /container -->
  </body>
</html>

